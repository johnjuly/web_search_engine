<!-- ui/index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>æ ¡å›­é€šçŸ¥æœç´¢</title>
    <!-- å¼•å…¥Bootstrapç¾åŒ– -->
    <link
      href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .highlight {
        background-color: #ffeb3b;
        padding: 0 0.2em;
      }
      .result-card {
        transition: all 0.3s;
      }
      .result-card:hover {
        transform: translateY(-5px);
      }
      #loading {
        display: none;
      }
    </style>
  </head>
  <body>
    {% raw %}
    <div class="container py-5">
      <h1 class="text-center mb-4">ğŸ“š æ ¡å›­é€šçŸ¥æœç´¢å¼•æ“</h1>

      <!-- æœç´¢æ¡† -->
      <div class="input-group mb-4">
        <input
          type="text"
          class="form-control form-control-lg"
          placeholder="è¯·è¾“å…¥å…³é”®è¯ï¼ˆå¦‚ï¼šå¥–å­¦é‡‘ã€æ”¾å‡é€šçŸ¥ï¼‰"
          v-model="query"
          @input="handleSearch"
        />
        <button class="btn btn-primary" @click="handleSearch">ğŸ” æœç´¢</button>
      </div>

      <!-- åŠ è½½æç¤º -->
      <div id="loading" class="text-center mb-3">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">åŠ è½½ä¸­...</span>
        </div>
        <span class="ms-2">æ­£åœ¨åŠªåŠ›æœç´¢ä¸­...</span>
      </div>

      <!-- ç»“æœå±•ç¤º -->
      <div v-if="results.length" class="row g-4">
        <div
          v-for="(item, index) in results"
          :key="index"
          class="col-12 result-card"
        >
          <div class="card h-100 shadow-sm">
            <div class="card-body">
              <h5 class="card-title" v-html="item.title"></h5>
              <p class="card-text text-muted" v-html="item.content"></p>
              <div class="d-flex justify-content-between align-items-center">
                <a
                  :href="item.url"
                  class="btn btn-outline-primary btn-sm"
                  target="_blank"
                >
                  æŸ¥çœ‹åŸæ–‡
                </a>
                <small class="text-muted">
                  {{ item.publish_date ? item.publish_date : 'æœªçŸ¥æ—¥æœŸ' }}
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- æ— ç»“æœæç¤º -->
      <div v-else-if="query.length >= 2" class="alert alert-warning">
        æœªæ‰¾åˆ°ç›¸å…³ç»“æœï¼Œè¯·å°è¯•å…¶ä»–å…³é”®è¯
      </div>
    </div>
    {% endraw %}
    <!-- å¼•å…¥Vueå’Œaxios -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/1.5.0/axios.min.js"></script>

    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            query: "",
            results: [],
            isLoading: false,
          };
        },
        methods: {
          async handleSearch() {
            if (this.query.length < 2) return;

            this.isLoading = true;
            try {
              const response = await axios.post(
                "http://localhost:8000/search",
                { query: this.query }
              );

              this.results = response.data.items;
            } catch (error) {
              console.error("æœç´¢å¤±è´¥:", error);
              alert("æœç´¢æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•");
            } finally {
              this.isLoading = false;
            }
          },
        },
        watch: {
          isLoading(newVal) {
            document.getElementById("loading").style.display = newVal
              ? "block"
              : "none";
          },
        },
      }).mount(".container");
    </script>
  </body>
</html>
